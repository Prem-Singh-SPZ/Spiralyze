const bs_path = '//res.cloudinary.com/spiralyze/image/upload/';
let page_setup = [
    {
        'page_class': 'spz-ppc-proxy-click',
        'form_title': 'Make the visitor check-in experience <span>50% faster</span> while improving security.',
        'site_logo': bs_path + 'v1702565045/eptura/3017/proxyclick_logo.svg',
        'logo_alt': 'Proxyclick',
        'hero_image': {
            'desktop': bs_path + 'f_auto/eptura/3017/img-proxyclick-1440_1.webp',
            'tablet': bs_path + 'f_auto/eptura/3017/img-1_15.webp'
        },
        'list_item': [
            '<strong>Visitor check-in.</strong> Create badges, control access, and get real-time alerts. Pre-screen. Self-check in kiosks.',
            '<strong>Security & compliance.</strong> Include identity verification, NDAs, safety briefings, or health screens. Log compliance.',
            '<strong>Integrations.</strong> Sync data with internal access and security systems. Automated email or Slack notifications.'
        ],
        'client_logos': {
            'lg_desk': bs_path + 'v1709042774/eptura/3019/proxyclick-client-logos-1920.svg',
            'desktop': bs_path + 'v1709042538/eptura/3019/proxyclick-client-logos.svg',
            'tablet': bs_path + 'v1709042775/eptura/3019/proxyclick-client-logos-tab.svg',
            'mobile': bs_path + 'v1709042774/eptura/3019/proxyclick-client-logos-mob.svg'
        }
    },
    {
        'page_class': 'spz-ppc-archibus',
        'form_title': 'Automate preventive maintenance and repair. Reduce costs <span>by 30%.</span>',
        'site_logo': bs_path + 'v1702565375/eptura/3017/endorsed_logos_1.svg',
        'logo_alt': 'Archibus',
        'hero_image': {
            'desktop': bs_path + 'f_auto/eptura/3017/img-archibus-1440_1.webp',
            'tablet': bs_path + 'f_auto/eptura/3017/img-1_19.webp'
        },
        'list_item': [
            '<strong>Work orders.</strong> Automatically generate detailed work orders when assets are due for maintenance.',
            '<strong>Repair management.</strong> Auto-send requests to relevant workers via the mobile app. See repair status and track orders.',
            '<strong>Budgeting.</strong> Get analytics on cost, labor, and performance of operations. Easily generate plans and budgets.'
        ],
        'client_logos': {
            'lg_desk': bs_path + 'v1709112543/eptura/3019/archibus/archibus-client-logos.svg',
            'desktop': bs_path + 'v1709112543/eptura/3019/archibus/archibus-client-logos.svg',
            'tablet': bs_path + 'v1709112543/eptura/3019/archibus/archibus-client-logos-tab.svg',
            'mobile': bs_path + 'v1709112543/eptura/3019/archibus/archibus-client-logos-mob.svg'
        }
    },
    {
        'page_class': 'spz-ppc-eptura',
        'form_title': 'Automate operations with one platform for workplace and asset management.',
        'site_logo': bs_path + 'v1702565415/eptura/3017/main_logo_1.svg',
        'logo_alt': 'Eptura',
        'hero_image': {
            'desktop': bs_path + 'f_auto/eptura/3017/img-eptura-1440.webp',
            'tablet': bs_path + 'f_auto/eptura/3017/img-1_21.webp'
        },
        'list_item': [
            '<strong>Workplace solutions.</strong> Desk and meeting room bookings, visitor management, and space planning.',
            '<strong>Asset visibility.</strong> See asset inventory, lifecycles, and compliance details. Get a complete view of facilities and spaces.',
            '<strong>Maintenance.</strong> Automate preventive maintenance, view cost history, and schedule repairs for all your assets.'
        ],
        'client_logos': {
            'lg_desk': bs_path + 'v1709113481/eptura/3019/eptura/eptura-client-logos.svg',
            'desktop': bs_path + 'v1709113481/eptura/3019/eptura/eptura-client-logos.svg',
            'tablet': bs_path + 'v1709113481/eptura/3019/eptura/eptura-client-logos-tab.svg',
            'mobile': bs_path + 'v1709113481/eptura/3019/eptura/eptura-client-logos-mob.svg'
        }
    },
    {
        'page_class': 'spz-ppc-condeco',
        'form_title': 'Streamline desk and meeting room scheduling. Simplify<br> hybrid work.',
        'site_logo': bs_path + 'v1702565303/eptura/3017/endorsed_logos_2.svg',
        'logo_alt': 'Condeco',
        'hero_image': {
            'desktop': bs_path + 'f_auto/eptura/3017/img-condeco-1440.webp',
            'tablet': bs_path + 'f_auto/eptura/3017/img-1_17.webp'
        },
        'list_item': [
            '<strong>Bookings.</strong> Schedule desks, meetings, and parking via the app or your calendar. Instantly notify attendees of any changes.',
            '<strong>Room selection.</strong> Find rooms with the equipment and space you need. Auto-book new rooms if you reschedule meetings.',
            '<strong>Collaboration.</strong> See when co-workers will be in the office and their desk location. Easily manage your hybrid work schedule.'
        ],
        'client_logos': {
            'lg_desk': bs_path + 'v1709110289/eptura/3019/condeco/condeco-client-logos.svg',
            'desktop': bs_path + 'v1709110289/eptura/3019/condeco/condeco-client-logos.svg',
            'tablet': bs_path + 'v1709110289/eptura/3019/condeco/condeco-client-logos-tab.svg',
            'mobile': bs_path + 'v1709110289/eptura/3019/condeco/condeco-client-logos-mob.svg'
        }
    },
    {
        'page_class': 'spz-ppc-eptura-asset',
        'form_title': 'Automate equipment maintenance. Reduce costs. Increase performance.',
        'site_logo': bs_path + 'v1702565415/eptura/3017/main_logo_1.svg',
        'logo_alt': 'Eptura',
        'hero_image': {
            'desktop': bs_path + 'f_auto/eptura/3017/img-asset_management-1440.webp',
            'tablet': bs_path + 'f_auto/eptura/3017/img-1_23.webp'
        },
        'list_item': [
            '<strong>Work orders.</strong> View all work orders in one portal. Easily provide technicians with schedules, locations, and task descriptions.',
            '<strong>Lifecycle tracking.</strong> See your cost history, repair schedules, and upcoming preventive maintenance for all your assets.',
            '<strong>Cost forecasting.</strong> Track expenses and cost comparisons. Create monthly budgets based on historical data.'
        ],
        'client_logos': {
            'lg_desk': bs_path + 'v1709114439/eptura/3019/asstmgt/asstmgnt-client-logos.svg',
            'desktop': bs_path + 'v1709114439/eptura/3019/asstmgt/asstmgnt-client-logos.svg',
            'tablet': bs_path + 'v1709114439/eptura/3019/asstmgt/asstmgnt-client-logos-tab.svg',
            'mobile': bs_path + 'v1709114439/eptura/3019/asstmgt/asstmgnt-client-logos-mob.svg'
        }
    },
    {
        'page_class': 'spz-ppc-eptura-room',
        'form_title': 'Streamline workspace bookings. Boost hybrid collaboration.',
        'site_logo': bs_path + 'v1702565415/eptura/3017/main_logo_1.svg',
        'logo_alt': 'Eptura',
        'hero_image': {
            'desktop': bs_path + 'f_auto/eptura/3017/img-room_management-1440.webp',
            'tablet': bs_path + 'f_auto/eptura/3017/img-1_27.webp'
        },
        'list_item': [
            '<strong>Bookings.</strong> Schedule desks, meeting rooms, and parking. Book rooms with the right equipment for any meeting.',
            '<strong>Navigation.</strong> Digital floor plans make it easy to find the right room or locate the one you’ve booked upon arrival.',
            '<strong>Collaboration.</strong> See when co-workers will be in the office and their desk location. Easily manage your hybrid work schedule.',
        ],
        'client_logos': {
            'lg_desk': bs_path + 'v1709115385/eptura/3019/roommgt/roommgnt-client-logos.svg',
            'desktop': bs_path + 'v1709115385/eptura/3019/roommgt/roommgnt-client-logos.svg',
            'tablet': bs_path + 'v1709115385/eptura/3019/roommgt/roommgnt-client-logos-tab.svg',
            'mobile': bs_path + 'v1709115385/eptura/3019/roommgt/roommgnt-client-logos-mob.svg'
        }
    }
];

let single_page_setup = '';

if (location.href.indexOf('ppc-proxyclick-discover-a-better-way-to-check-in-visitors') != -1) {
    single_page_setup = page_setup[0];
} else if (location.href.indexOf('ppc-archibus-maintenance-software') != -1) {
    single_page_setup = page_setup[1];
} else if (location.href.indexOf('ppc-eptura') != -1 && location.href.indexOf('ppc-eptura-asset-management') == -1 && location.href.indexOf('ppc-eptura-room-management') == -1) {
    single_page_setup = page_setup[2];
} else if (location.href.indexOf('ppc-condeco-make-your-flexible-office-work-better') != -1) {
    single_page_setup = page_setup[3];
} else if (location.href.indexOf('ppc-eptura-asset-management') != -1) {
    single_page_setup = page_setup[4];
} else if (location.href.indexOf('ppc-eptura-room-management') != -1) {
    single_page_setup = page_setup[5];
}

(function () {

    // document.querySelector('.spz-customers').remove();

    let custom_html = `
    <div class="spz-customers">
        <div class="spz-customers-wrap">
            <h6>Connect to <span>40+</span> platforms</h6>
            <div class="spz-customer-logos">
                <div class="spz-customer-logos-wrap">
                    <picture>
                        <source media="(min-width:1600px)" srcset="${single_page_setup.client_logos.lg_desk}">
                        <source media="(min-width:1199.98px)" srcset="${single_page_setup.client_logos.desktop}">
                        <source media="(min-width:767.98px)" srcset="${single_page_setup.client_logos.tablet}">
                        <img src="${single_page_setup.client_logos.mobile}" alt="Client logos">
                    </picture>
                </div>
            </div>
        </div>
    </div>
    `;

    let hero_content = `
    <div class="spz-hero-contents">
        <div class="spz-hero-content-wrap">
            <div class="spz-hero-image-list">
                <picture>
                    <source media="(min-width:1199.98px)" srcset="${single_page_setup.hero_image.desktop}">
                    <source media="(min-width:767.98px)" srcset="${single_page_setup.hero_image.tablet}">
                    <img src="${single_page_setup.hero_image.tablet}" alt="Hero Image">
                  </picture>
                  <ul class="spz-hero-list">${genList()}</ul>
            </div>
            <div class="spz-footer">
                <div class="spz-footer-wrap">
                    <ul class="spz-footer-links">
                        <li><a href="https://eptura.com/terms/saas-privacy-policy">SaaS Privacy Policy</a></li>
                        <li><a href="https://eptura.com/terms/privacy-policy/">Privacy Policy</a></li>
                        <li><a href="https://eptura.com/terms/modern-slavery/">Modern Slavery</a></li>
                    </ul>
                    <label class="spz-footer-copyright">All Rights Reserved © Eptura™</label>
                </div>
            </div>
        </div>
    </div>
    `;

    document.body.classList.add('spz-3019');
    if (single_page_setup != '') {
        document.body.classList.add(single_page_setup.page_class);
    }
    waitForElm('#bodyId #hero #HeroFormCol #HeroForm .mktoForm .mktoFormRow .mktoField').then(function () {
        document.body.classList.add('spz-3019');
        loadTest();
        clearFormFields();
        checkVisibleInputs();

        document.querySelectorAll('a[href="#DemoRequest"]').forEach(function (el) {
            el.setAttribute('href', '#HeroFormPanel');
        });
    });

    //Clear form fields
    function clearFormFields() {
        document.querySelectorAll('#HeroForm .mktoForm .mktoFormRow .mktoField:not([type="checkbox"]):not([type="hidden"])').forEach(function (el) {
            el.value = '';
            if (el.closest('.mktoFormCol').classList.contains('input-filled')) {
                el.closest('.mktoFormCol').classList.remove('input-filled');
            }
        });
    }

    function loadTest() {
        formUpdate();
        focusFields();

        // Add class 'safari' (used for cart scrollbar)
        if (navigator.userAgent.toLowerCase().indexOf('chrome/') == -1 && navigator.userAgent.toLowerCase().indexOf('safari/') > -1) {
            document.querySelector('body').classList.add('safari');
        }
        window.addEventListener("click", function (e) {
            if (e.target.classList.contains("show-comment-dynamic")) {
                e.target.parentElement.classList.add('spz-hidden');
                this.document.querySelector('#Lead_Notes__c').focus();
            }

            if (e.target.classList.contains("mktoField")) {
                showGlobalError();
            }

            if (e.target.classList.contains("mktoButton")) {
                document.querySelectorAll('#HeroForm .mktoForm .mktoFormRow .mktoField:not([type="checkbox"]):not([type="hidden"])').forEach(function (el) {
                    checkError(el);
                    showGlobalError();
                });
            }
        });
        document.querySelector('head').insertAdjacentHTML("afterbegin", `<link rel="preload" href="https://res.cloudinary.com/spiralyze/image/upload/v1692677050/eptura/3002/form-checkmark-errored.svg" as="image"><link rel="preload" href="https://res.cloudinary.com/spiralyze/image/upload/v1691420998/eptura/3001/custom/form-checkmark-hover.svg" as="image"><link rel="preload" href="https://res.cloudinary.com/spiralyze/image/upload/v1691420998/eptura/3001/custom/form-checkmark-checked.svg" as="image">`
        );
        document.body.classList.add('spz-load-complete');
    }

    //custom error for checkbox field
    function showGlobalError() {
        let checkErrorforCheckBox = setInterval(() => {
            if (document.querySelector('.mktoLogicalField.mktoCheckboxList.mktoInvalid') && document.querySelector('.mktoLogicalField.mktoCheckboxList.mktoInvalid + .mktoError')) {
                document.querySelector('#LblSingle_Opt_In__c').closest('.mktoFieldWrap').classList.add('spz-cstm-error');
            }
            else {
                document.querySelector('#LblSingle_Opt_In__c').closest('.mktoFieldWrap').classList.remove('spz-cstm-error');
            }
        }, 50);

        setTimeout(() => {
            clearInterval(checkErrorforCheckBox);
        }, 1000);
    }

    //Marketo form update
    function formUpdate() {
        document.querySelector('#HeroFormCol .mktoForm em').innerHTML = `Trouble submitting? <br class="mobile-only"> Email us at <a href="mailto:info@eptura-marketing.com" target="_blank" id="">info@eptura-marketing.com</a>`;

        document.querySelector('#HeroFormCol .mktoForm em').closest('.mktoFormRow').classList.add('spz-email');
        document.querySelector('#HeroFormCol .mktoForm .spz-email').before(document.querySelector('#HeroFormCol .mktoForm .mktoButtonRow'));

        if (document.querySelector('form#mktoForm_1225 textarea[name="Lead_Notes__c"]').closest('.mktoFormRow').querySelectorAll('.spz-anchor').length == 0) {
            // document.querySelector('form#mktoForm_1225 textarea[name="Lead_Notes__c"]').closest('.mktoFormRow').insertAdjacentHTML(`afterbegin`, `<div class="spz-anchor"><a href="javascript:void(0);" class="show-comment-dynamic">+ Comment</a></div>`);
        }

        document.querySelector('#I_am__c').addEventListener('change', function () {
            dropdownFunctionality(this.value);
        });

        document.querySelector('#LblI_am__c').textContent = 'I am...*';

        // Add form title and sub title
        if (document.querySelectorAll('#HeroFormCol #HeroFormTitleText .spz-form-title').length == 0 && single_page_setup.form_title) {
            document.querySelector('#HeroFormCol #HeroFormTitleText').insertAdjacentHTML('afterbegin', `<div class="spz-site-logo"><img src="${single_page_setup.site_logo}" alt="${single_page_setup.logo_alt}"></div><p class="spz-form-title">${single_page_setup.form_title}</p>`);
        }

        // Add Custom Logos
        if (document.querySelectorAll('#HeroFormPanel .spz-customers').length == 0) {
            document.querySelector('#HeroFormPanel').insertAdjacentHTML('afterend', custom_html);
        }

        // Add hero content section
        if (document.querySelector('#HeroFormCol').parentNode.querySelectorAll('.spz-hero-contents').length == 0) {
            document.querySelector('#HeroFormCol').insertAdjacentHTML('afterend', hero_content);
        }

        if (document.querySelector('#HeroFormCol #HeroFormTitleText h2')) {
            document.querySelector('#HeroFormCol #HeroFormTitleText h2').outerHTML = '<h6>Get a demo</h6>';
        }

        const gInt = setInterval(() => {
            if (document.querySelector('#HeroFormCol #HeroFormTitleText h6').innerText.includes('GET STARTED') && document.querySelector('#HeroFormCol #HeroFormTitleText h6')) {
                document.querySelector('#HeroFormCol #HeroFormTitleText h6').innerHTML = 'Get a demo';
                clearInterval(gInt);
            }
        }, 500);

        document.querySelector('#mktoForm_1225 .mktoButtonRow button[type="submit"].mktoButton').addEventListener('click', function () {
            setTimeout(() => {

                if (!document.querySelector('#HeroForm .mktoForm').classList.contains('fully-load')) {
                    var eventclick = new Event('focus');
                    var inpEmail = document.querySelector('.mktoEmailField');
                    var inpIam = document.querySelector('#I_am__c');

                    if (inpEmail.value == '' || !validateEmail(inpEmail.value)) {
                        // Return if input '#FirstName' and '#LastName' is empty
                        if (document.querySelector('#FirstName').value == '' || document.querySelector('#LastName').value == '') {
                            return;
                        }

                        var eml = MktoForms2.allForms()[0].getFormElem().find("#Email");
                        MktoForms2.allForms()[0].showErrorMessage('Must be valid email. example@yourdomain.com', eml);
                        inpEmail.dispatchEvent(eventclick);
                        inpEmail.closest('.mktoFormCol').classList.add('field-error');
                        inpEmail.focus();

                    } else {
                        if (inpIam.value == '') {
                            var emlIam = MktoForms2.allForms()[0].getFormElem().find("#I_am__c");
                            MktoForms2.allForms()[0].showErrorMessage('This field is required.', emlIam);
                            inpIam.dispatchEvent(eventclick);
                            inpIam.closest('.mktoFormCol').classList.add('field-error');
                        }
                    }
                }
            }, 200)
        })
    }

    //On value change of "I am.." field switch label od comment button
    function dropdownFunctionality(val) {
        let setBuffer = setInterval(() => {
            if (document.querySelector('#Lead_Notes__c')) {
                if (document.querySelector('.spz-anchor').classList.contains('spz-hidden')) {
                    document.querySelector('.spz-anchor').classList.remove('spz-hidden');
                }
            }
            else {
                document.querySelector('.spz-anchor').classList.add('spz-hidden');
            }

            if (val == 'Other' || val == 'A current client' || val == 'A current Partner') {
                document.querySelector('.show-comment-dynamic').textContent = '+ Please let us know how we may assist you';
            }
            else {
                document.querySelector('.show-comment-dynamic').textContent = '+ Comment';
            }
            focusFields();
        }, 5);

        setTimeout(() => {
            clearInterval(setBuffer);
        }, 50);
    }

    // On input focus add class on closest parent field class
    function focusFields() {
        document.querySelectorAll('#HeroForm .mktoForm .mktoFormRow .mktoField:not([type="checkbox"]):not([type="hidden"])').forEach(function (el) {

            blockChar();

            el.addEventListener('focus', function () {
                el.closest('.mktoFormCol').classList.add('field-focus');
            });
            el.addEventListener('blur', function () {
                el.closest('.mktoFormCol').classList.remove('field-focus');
                checkError(el);
            });

            // add event listeners to the input element
            el.addEventListener('keypress', () => {
                checkError(el);
            });

            el.addEventListener('change', () => {
                checkError(el);
            });

            el.addEventListener('keydown', () => {
                checkError(el);
            });

            el.addEventListener('keyup', () => {
                checkError(el);
            });
        });
    }

    // Function to add .field-error class on closest parent .field class if .error is exist on input
    function checkError(elem) {
        let timeBuffer = setInterval(() => {
            if (elem.closest('.mktoFormCol ').querySelector('.mktoError') && elem.closest('.mktoFormCol').querySelector('.mktoInvalid')) {
                elem.closest('.mktoFormCol').classList.add('field-error');
            } else {
                elem.closest('.mktoFormCol').classList.remove('field-error');
            }
            if (elem && elem.value && (elem.value != '')) {
                elem.closest('.mktoFormCol').classList.add('input-filled');
                // elem.closest('.mktoFormCol').classList.remove('field-error');
            } else {
                elem.closest('.mktoFormCol').classList.remove('input-filled');
                // elem.closest('.mktoFormCol').classList.add('field-error');
            }
            checkVisibleInputs();
        }, 100);

        setTimeout(() => {
            clearInterval(timeBuffer);
        }, 1000);
    }

    // Check if all fields are visible
    function checkVisibleInputs() {
        waitForElm('.mktoFormCol[style*="display: none"]').then(function () {
            if (document.querySelectorAll('.mktoFormCol[style*="display: none"]').length == 4) {
                document.querySelector('#HeroForm .mktoForm').classList.add('initial-load');
            }

            if (document.querySelectorAll('.mktoFormCol:not(.input-filled)[style*="display: none"]').length <= 1) {
                document.querySelector('#HeroForm .mktoForm').classList.replace('initial-load', 'fully-load');
            }
        });
    }

    // Email validation
    function validateEmail(email) {
        var regex = /^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
        return regex.test(String(email).toLowerCase());
    }

    //Block "e" from number of employees field
    function blockChar() {
        document.querySelector('#NumberOfEmployees').addEventListener("keydown", function (e) {
            if (e.key == 'e') {
                e.preventDefault();
            }
        });
    }

    // Generic Code
    function waitForElm(selector) {
        return new Promise(function (resolve) {
            if (document.querySelector(selector)) {
                return resolve(document.querySelector(selector));
            }
            const observer = new MutationObserver(function (mutations) {
                if (document.querySelector(selector)) {
                    resolve(document.querySelector(selector));
                    observer.disconnect();
                }
            });
            observer.observe(document, { attributes: true, childList: true, subtree: true, characterData: true });
        });
    }

    // Generate list content
    function genList() {
        if (single_page_setup != '' && single_page_setup.list_item.length > 0) {
            let list_arr = '';
            for (var list_item of single_page_setup.list_item) {
                list_arr += `<li>${list_item}</li>`;
            }
            return list_arr;
        }
    }
})();